"use strict";(self.webpackChunkpoemsng=self.webpackChunkpoemsng||[]).push([[682],{2682:(fe,F,i)=>{i.r(F),i.d(F,{ReaderViewModule:()=>_e});var s=i(6895),m=i(4006),w=i(7077),R=i(9299),P=i(6818),e=i(4650),d=i(7888),T=i(5545),S=i(5599),u=i(3872),v=i(4859),A=i(7392),p=i(6338),g=i(3267),y=i(3683),Z=i(266),M=i(6849),Q=i(9291),E=i(1983);function L(n,a){if(1&n&&(e.TgZ(0,"mat-list-option",16,17)(2,"span",18),e._uU(3),e.qZA(),e.TgZ(4,"span",19),e._uU(5),e.ALo(6,"date"),e.qZA()()),2&n){const t=a.$implicit;e.Q6J("value",t),e.xp6(3),e.hij(" ",t.title," "),e.xp6(2),e.hij(" \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0",e.xi3(6,3,t.published,"yyyy-MM-dd")," ")}}function B(n,a){if(1&n&&e._UZ(0,"album-meta-viewer",20),2&n){const t=e.oxw();e.Q6J("data",t.currentAlbum)("showTitle",!0)}}function D(n,a){if(1&n&&(e.TgZ(0,"div"),e._UZ(1,"poem-viewer",21,22)(3,"p"),e.qZA()),2&n){const t=a.$implicit,o=e.oxw();e.xp6(1),e.Q6J("data",t)("settings",o.albumPoemViewerSettings)}}function V(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",23),e.NdJ("click",function(){e.CHM(t);const l=e.oxw();return e.KtG(l.copyToClipboard())}),e._UZ(1,"mat-icon",24),e.qZA()}}let G=(()=>{class n extends P.k{constructor(t,o,l,r,c,h,C){super(t,o,l,r,c,C),this.alertService=t,this.albumsService=o,this.poemsService=l,this.basicDataLoaderService=r,this.waitService=c,this.ref=h,this.langSubjectService=C}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(d.c9),e.Y36(T.T.Albums),e.Y36(T.T.Poems),e.Y36(S.k),e.Y36(d.ii),e.Y36(e.sBO),e.Y36(u.IZ))},n.\u0275cmp=e.Xpm({type:n,selectors:[["albums-for-reader"]],features:[e.qOj],decls:25,vars:7,consts:function(){let a;return a=$localize`Copy album to clipboard`,[[1,"fixed-top"],[3,"ngClass"],["toolbar",""],[1,"toolbar-spacer"],["mat-mini-fab","","color","any","type","button","aria-label","toggle sidebar",3,"click"],["hasBackdrop","false","scrollable",""],["mode","over","opened","","fixedInViewport","true","position","end","autoFocus","false",1,"fx-50pc-width",3,"fixedTopGap"],["sidenav",""],["sidenavContent",""],[3,"multiple","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["fixedInViewport","true"],[3,"data","showTitle",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"viewer-margin"],["mat-mini-fab","","color","any","matTooltip",a,3,"click",4,"ngIf"],[3,"value"],["ca","matListOption"],["matListItemTitle",""],["matListItemLine",""],[3,"data","showTitle"],[3,"data","settings"],["poemViewers",""],["mat-mini-fab","","color","any","matTooltip",a,3,"click"],["color","primary","svgIcon","c_clipboard_copy"]]},template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"mat-toolbar",1,2),e._UZ(3,"main-buttons")(4,"span",3),e.TgZ(5,"button",4),e.NdJ("click",function(){return o.toggleSidenav()}),e.TgZ(6,"mat-icon"),e._uU(7,"reorder"),e.qZA()()()(),e.TgZ(8,"div")(9,"mat-sidenav-container",5)(10,"mat-sidenav",6,7)(12,"div",null,8)(14,"mat-selection-list",9),e.NdJ("selectionChange",function(r){return o.handleAlbumChange(r)}),e.YNc(15,L,7,6,"mat-list-option",10),e.qZA()()(),e.TgZ(16,"mat-sidenav-content",11),e.YNc(17,B,1,2,"album-meta-viewer",12),e._UZ(18,"p"),e.YNc(19,D,4,2,"div",13),e._UZ(20,"p"),e.TgZ(21,"div",14),e.YNc(22,V,2,0,"button",15),e.qZA(),e._UZ(23,"p"),e.qZA()(),e._UZ(24,"p"),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngClass",o.isSmallScreen?"fx-column-gap-half":"fx-column-gap-1"),e.xp6(9),e.Q6J("fixedTopGap",o.mainToolbarHeight),e.xp6(4),e.Q6J("multiple",!1),e.xp6(1),e.Q6J("ngForOf",o.albums),e.xp6(2),e.Q6J("ngIf",o.currentAlbum.id),e.xp6(2),e.Q6J("ngForOf",o.poemsOfAlbum),e.xp6(3),e.Q6J("ngIf",o.currentAlbum.id&&o.copyAlbumEnabled))},dependencies:[s.mk,s.sg,s.O5,v.nh,A.Hw,p.Ub,p.vS,p.WW,p.sL,g.JX,g.TM,g.Rh,y.Ye,Z.gM,M.X,Q.E,E.d,s.uU],encapsulation:2}),n})();var $=i(9019),_=i(5529),H=i(7414),j=i(6900),W=i(4308),k=i(8353),X=i(7516),K=i(6709),O=i(7331),b=i(7084),N=i(782),z=i(284),x=i(9549),f=i(5423),J=i(8184);function q(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"mat-chip-option",28),e.NdJ("selectionChange",function(l){e.CHM(t);const r=e.oxw(3);return e.KtG(r.handleTagSelectionChange(l))}),e._uU(1),e.qZA()}if(2&n){const t=a.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}function ee(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"mat-expansion-panel")(1,"mat-expansion-panel-header")(2,"mat-panel-title"),e.SDv(3,22),e.qZA(),e.TgZ(4,"mat-panel-description"),e._uU(5),e.qZA()(),e.TgZ(6,"div")(7,"mat-checkbox",23),e._uU(8,"Filtered by multiple tags"),e.qZA()(),e.TgZ(9,"div",24)(10,"mat-chip-listbox",25,26),e.NdJ("change",function(l){e.CHM(t);const r=e.oxw(2);return e.KtG(r.handleTagsChange(l))}),e.YNc(12,q,2,2,"mat-chip-option",27),e.qZA()()()}if(2&n){const t=e.oxw(2);e.xp6(5),e.hij(" ",t.tagNames," "),e.xp6(2),e.Q6J("formControl",t.multipleTagsControl),e.xp6(3),e.Q6J("multiple",t.multipleTagsControl.value),e.xp6(2),e.Q6J("ngForOf",t.tags)}}function te(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"mat-tree-node",35),e._uU(1," \xa0\xa0\xa0\xa0\xa0\xa0 "),e.TgZ(2,"button",36),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw(4);return e.KtG(c.handleYearMonthNode(r.data))}),e._uU(3),e.qZA()()}if(2&n){const t=a.$implicit;e.xp6(3),e.Oqu(t.data.display)}}function ne(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"mat-tree-node",35)(1,"button",37)(2,"mat-icon",38),e._uU(3),e.qZA()(),e.TgZ(4,"button",36),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw(4);return e.KtG(c.handleYearMonthNode(r.data))}),e._uU(5),e.qZA()()}if(2&n){const t=a.$implicit,o=e.oxw(4);e.xp6(1),e.uIk("aria-label","Toggle "+t.name),e.xp6(2),e.hij(" ",o.yearTreeControl.isExpanded(t)?"expand_more":"chevron_right"," "),e.xp6(2),e.Oqu(t.data.display)}}function oe(n,a){if(1&n&&(e.TgZ(0,"mat-tree",32),e.YNc(1,te,4,1,"mat-tree-node",33),e.YNc(2,ne,6,3,"mat-tree-node",34),e.qZA()),2&n){const t=e.oxw(3);e.Q6J("dataSource",t.dataSource)("treeControl",t.yearTreeControl),e.xp6(2),e.Q6J("matTreeNodeDefWhen",t.hasChild)}}function ae(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",29,30),e.NdJ("click",function(l){e.CHM(t);const r=e.oxw(2);return e.KtG(r.toggleTree(l))}),e.TgZ(2,"mat-icon"),e._uU(3,"account_tree"),e.qZA()(),e.YNc(4,oe,3,3,"ng-template",31)}if(2&n){const t=e.MAs(1),o=e.oxw(2);e.xp6(4),e.Q6J("cdkConnectedOverlayOrigin",t)("cdkConnectedOverlayOpen",o.isTreeOpen)}}function ie(n,a){if(1&n&&(e.TgZ(0,"span",43),e._uU(1),e.ALo(2,"date"),e.qZA()),2&n){const t=e.oxw().$implicit;let o;e.Q6J("ngClass",t.published?"published":"draft"),e.xp6(1),e.hij("\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0",e.xi3(2,2,null!==(o=t.published)&&void 0!==o?o:t.date,"yyyy-MM-dd"),"")}}function le(n,a){if(1&n&&(e.TgZ(0,"mat-list-option",39,40)(2,"span",41),e._uU(3),e.qZA(),e.YNc(4,ie,3,5,"span",42),e.qZA()),2&n){const t=a.$implicit,o=e.oxw(2);e.Q6J("value",t.id),e.xp6(3),e.Oqu(t.title),e.xp6(1),e.Q6J("ngIf",o.usePublished)}}function re(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"mat-sidenav-container",1)(1,"mat-sidenav",2,3)(3,"div",null,4),e.YNc(5,ee,13,4,"mat-expansion-panel",5),e._UZ(6,"div",6),e.TgZ(7,"mat-grid-list",7)(8,"mat-grid-tile",8),e._uU(9," \xa0\xa0 "),e.TgZ(10,"form",9,10),e.NdJ("ngSubmit",function(){e.CHM(t);const l=e.MAs(11),r=e.oxw();return e.KtG(l.form.valid&&r.search())}),e.TgZ(12,"mat-form-field",11)(13,"mat-label"),e.SDv(14,12),e.qZA(),e._UZ(15,"input",13),e.TgZ(16,"button",14)(17,"mat-icon"),e._uU(18,"search"),e.qZA()(),e.TgZ(19,"button",15),e.NdJ("click",function(){e.CHM(t);const l=e.oxw();return e.KtG(l.clearKeywords())}),e.TgZ(20,"mat-icon"),e._uU(21,"close"),e.qZA()()()()(),e.TgZ(22,"mat-grid-tile",8)(23,"label",16),e._uU(24),e.qZA()(),e.TgZ(25,"mat-grid-tile",8),e.YNc(26,ae,5,2,"ng-template",0),e.qZA()(),e.TgZ(27,"mat-selection-list",17,18),e.NdJ("selectionChange",function(l){e.CHM(t);const r=e.oxw();return e.KtG(r.handlePoemListChange(l))}),e.YNc(29,le,5,3,"mat-list-option",19),e.qZA()()(),e.TgZ(30,"mat-sidenav-content",20),e._UZ(31,"poem-viewer",21)(32,"p"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("fixedTopGap",t.fixedTopGap),e.xp6(4),e.Q6J("ngIf",t.tags.length>0),e.xp6(3),e.Q6J("colspan",3),e.xp6(7),e.s9C("placeholder",t.searchBoxPlaceHolder),e.Q6J("formControl",t.keywordsControl),e.xp6(1),e.Q6J("disabled",!t.keywordsControl.value),e.xp6(6),e.Q6J("colspan",1),e.xp6(2),e.Oqu(t.filteredPoemBriefs.length),e.xp6(1),e.Q6J("colspan",1),e.xp6(1),e.Q6J("ngIf",t.poemBriefs.length>20&&t.chronologyEnabled),e.xp6(1),e.Q6J("multiple",!1),e.xp6(2),e.Q6J("ngForOf",t.filteredPoemBriefs),e.xp6(2),e.Q6J("data",t.currentPoem)("settings",t.poemViewerSettings)}}function se(n,a){}let ce=(()=>{class n extends k.G{constructor(t,o,l,r,c,h,C,Y,U){super(t,o,l,c,Y,U),this.poemsService=t,this.alsertService=o,this.dataComponentDialogService=l,this.poemDeletedSubjectService=r,this.alertService=c,this.poemAssociationsChangedSubjectService=h,this.staticContentReloadSubjectService=C,this.langSubjectService=Y,this.allMetaService=U,this.staticContentReloadSubscription=this.staticContentReloadSubjectService.getMessage().subscribe(Ce=>{this.currentPoem={}})}ngOnDestroy(){this.staticContentReloadSubscription.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(T.T.Poems),e.Y36(d.c9),e.Y36(d.T4),e.Y36(u.VE),e.Y36(d.c9),e.Y36(u.ks),e.Y36(u.vw),e.Y36(u.IZ),e.Y36(X.j))},n.\u0275cmp=e.Xpm({type:n,selectors:[["chronicle-for-reader"]],features:[e.qOj],decls:2,vars:2,consts:function(){let a,t;return a=$localize`Search`,t=$localize` Tags `,[[3,"ngIf"],["hasBackdrop","false","scrollable",""],["mode","over","opened","","fixedInViewport","true","position","end","autoFocus","false",1,"fx-50pc-width",3,"fixedTopGap"],["sidenav",""],["sidenavContent",""],[4,"ngIf"],[1,"nav-space-block"],["name","search","cols","5","rowHeight","6em"],[3,"colspan"],["name","searchForm",1,"fx-full-width",3,"ngSubmit"],["f","ngForm"],[1,"fx-full-width"],a,["matInput","",3,"formControl","placeholder"],["mat-icon-button","","matPrefix","","type","submit","aria-label","search",3,"disabled"],["mat-icon-button","","matSuffix","","aria-label","clear keywords",3,"click"],[1,"float-right"],["aria-label","list of poems",3,"multiple","selectionChange"],["poemsSelectionList",""],[3,"value",4,"ngFor","ngForOf"],["fixedInViewport","true"],[3,"data","settings"],t,[3,"formControl"],[1,"scroll-tags"],["selectable","",3,"multiple","change"],["tagChipList",""],[3,"value","selectionChange",4,"ngFor","ngForOf"],[3,"value","selectionChange"],["mat-icon-button","","type","button","matTooltip","Chronology","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen"],[1,"scroll-tree",3,"dataSource","treeControl"],["matTreeNodePadding","",4,"matTreeNodeDef"],["matTreeNodePadding","",4,"matTreeNodeDef","matTreeNodeDefWhen"],["matTreeNodePadding",""],["mat-button","",3,"click"],["mat-icon-button","","matTreeNodeToggle",""],[1,"mat-icon-rtl-mirror"],[3,"value"],["ca","matListOption"],["matListItemTitle",""],["matListItemLine","",3,"ngClass",4,"ngIf"],["matListItemLine","",3,"ngClass"]]},template:function(t,o){1&t&&(e.YNc(0,re,33,14,"ng-template",0),e.YNc(1,se,0,0,"ng-template",0)),2&t&&(e.Q6J("ngIf",!o.groupedByYearMonth),e.xp6(1),e.Q6J("ngIf",o.groupedByYearMonth))},dependencies:[s.mk,s.sg,s.O5,m._Y,m.Fj,m.JJ,m.JL,m.F,m.oH,v.lW,v.RK,K.oG,O.z2,O.iO,b.ib,b.yz,b.yK,b.u4,N.Il,N.DX,A.Hw,z.Nt,x.KE,x.hX,x.qo,x.R9,p.Ub,p.vS,p.WW,p.sL,g.JX,g.TM,g.Rh,Z.gM,f.fQ,f.ah,f.eu,f.gi,f.uo,J.pI,J.xu,M.X,s.uU],encapsulation:2}),n})();function me(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const l=e.oxw();return e.KtG(l.reload())}),e.TgZ(1,"mat-icon"),e._uU(2,"refresh"),e.qZA()()}}let I=(()=>{class n extends j.A{get updateAvailable(){return H.d.swUpdateAvailable}constructor(t,o,l,r,c,h){super(t,l,r),this.alertService=t,this.poemsService=o,this.basicDataLoaderService=l,this.waitService=r,this.viewSettingsDialogService=c,this.staticContentReloadSubjectService=h,console.debug("MainForReaderComponent created. IsSmallScreen: "+this.isSmallScreen),this.staticContentReloadSubscription=this.staticContentReloadSubjectService.getMessage().subscribe(C=>{this.reload()})}ngOnInit(){console.debug("MainForReaderComponent init.")}ngOnDestroy(){this.staticContentReloadSubscription.unsubscribe()}loadBriefs(){$.y.staticReadonly?this.basicDataLoaderService.allMetaService.getBriefsOfPoems().subscribe(t=>{_.f.usePublished||t.sort((o,l)=>o.title.localeCompare(l.title,_.f.defaultWrittenLanguage)),this.poemBriefs=t,this.chronicle?(this.chronicle.filteredPoemBriefs=t.slice(),console.debug("this.chronicle.filteredPoemBriefs assigned.")):console.debug("chronicle not yet available."),this.waitService.setWait({loading:!1})}):this.poemsService.getBriefsOfPoems(_.f.convertZhHandler).subscribe({next:t=>{t&&(_.f.usePublished||t.sort((o,l)=>o.title.localeCompare(l.title,_.f.defaultWrittenLanguage)),this.poemBriefs=t,this.chronicle&&(this.chronicle.filteredPoemBriefs=t.slice())),this.waitService.setWait({loading:!1})},error:t=>{this.waitService.setWait({loading:!1}),this.alertService.error(t)}})}showViewSettings(){this.viewSettingsDialogService.open()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(d.c9),e.Y36(T.T.Poems),e.Y36(S.k),e.Y36(d.ii),e.Y36(W.M),e.Y36(u.vw))},n.\u0275cmp=e.Xpm({type:n,selectors:[["main-for-reader"]],features:[e.qOj],decls:15,vars:3,consts:[[1,"fixed-top"],[3,"ngClass"],["toolbar",""],["mat-mini-fab","","color","any","type","button","aria-label","refresh","matTooltip","Reload data",3,"click",4,"ngIf"],[1,"toolbar-spacer"],["type","button","mat-mini-fab","","color","any","aria-label","settings",3,"click"],["mat-mini-fab","","color","any","type","button","aria-label","toggle sidebar",3,"click"],[3,"poemBriefs"],["chronicle",""],["mat-mini-fab","","color","any","type","button","aria-label","refresh","matTooltip","Reload data",3,"click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"mat-toolbar",1,2),e._UZ(3,"main-buttons"),e.YNc(4,me,3,0,"button",3),e._UZ(5,"span",4),e.TgZ(6,"button",5),e.NdJ("click",function(){return o.showViewSettings()}),e.TgZ(7,"mat-icon"),e._uU(8,"settings"),e.qZA()(),e.TgZ(9,"button",6),e.NdJ("click",function(){return o.toggleSidenav()}),e.TgZ(10,"mat-icon"),e._uU(11,"reorder"),e.qZA()()()(),e.TgZ(12,"div"),e._UZ(13,"chronicle-for-reader",7,8),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngClass",o.isSmallScreen?"fx-column-gap-half":"fx-column-gap-1"),e.xp6(3),e.Q6J("ngIf",!o.isStaticReadonly&&!o.updateAvailable),e.xp6(9),e.Q6J("poemBriefs",o.poemBriefs))},dependencies:[s.mk,s.O5,v.nh,A.Hw,y.Ye,Z.gM,E.d,ce],encapsulation:2}),n})();var pe=i(6467);const de=[{path:"",component:(()=>{class n extends pe.w{constructor(){super()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["reader-index"]],features:[e.qOj],decls:2,vars:0,consts:[[1,"content-top-padding-relative"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"router-outlet"),e.qZA())},dependencies:[R.lC],encapsulation:2}),n})(),children:[{path:"",component:I},{path:"chronicle",component:I},{path:"albums",component:G}]}];let ue=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[R.Bz.forChild(de),R.Bz]}),n})();var ge=i(4466);let _e=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[s.ez,m.u5,m.UX,w.V,ge.m,ue]}),n})()}}]);