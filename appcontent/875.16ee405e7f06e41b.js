"use strict";(self.webpackChunkpoemsng=self.webpackChunkpoemsng||[]).push([[875],{9875:(Ae,y,i)=>{i.r(y),i.d(y,{ReaderViewModule:()=>Re});var c=i(6814),m=i(6223),L=i(300),A=i(8109),B=i(7194),e=i(5879),d=i(1212),T=i(3320),E=i(4909),_=i(9636),C=i(2296),Z=i(617),p=i(9038),g=i(2651),M=i(1274),S=i(2596),N=i(6371),H=i(4838),O=i(6141);function D(n,l){if(1&n&&(e.TgZ(0,"mat-list-option",16,17)(2,"span",18),e._uU(3),e.qZA(),e.TgZ(4,"span",19),e._uU(5),e.ALo(6,"date"),e.qZA()()),2&n){const t=l.$implicit;e.Q6J("value",t),e.xp6(3),e.hij(" ",t.title," "),e.xp6(2),e.hij(" \xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0",e.xi3(6,3,t.published,"yyyy-MM-dd")," ")}}function G(n,l){if(1&n&&e._UZ(0,"album-meta-viewer",20),2&n){const t=e.oxw();e.Q6J("data",t.currentAlbum)("showTitle",!0)}}function V(n,l){if(1&n&&(e.TgZ(0,"div"),e._UZ(1,"poem-viewer",21,22)(3,"p"),e.qZA()),2&n){const t=l.$implicit,o=e.oxw();e.xp6(1),e.Q6J("data",t)("settings",o.albumPoemViewerSettings)}}function $(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",23),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.copyToClipboard())}),e._UZ(1,"mat-icon",24),e.qZA()}}let j=(()=>{var n;class l extends B.k{constructor(o,a,r,s,u,f,h){super(o,a,r,s,u,f,h),this.alertService=o,this.albumsService=a,this.poemsService=r,this.basicDataLoaderService=s,this.waitService=u,this.langSubjectService=f,this.ref=h}}return(n=l).\u0275fac=function(o){return new(o||n)(e.Y36(d.c9),e.Y36(T.T.Albums),e.Y36(T.T.Poems),e.Y36(E.k),e.Y36(d.ii),e.Y36(_.IZ),e.Y36(e.sBO))},n.\u0275cmp=e.Xpm({type:n,selectors:[["albums-for-reader"]],features:[e.qOj],decls:25,vars:7,consts:function(){let t;return t=$localize`Copy album to clipboard`,[[1,"fixed-top"],[3,"ngClass"],["toolbar",""],[1,"toolbar-spacer"],["mat-mini-fab","","color","any","type","button","aria-label","toggle sidebar",3,"click"],["hasBackdrop","false","scrollable",""],["mode","over","opened","","fixedInViewport","true","position","end","autoFocus","false",1,"fx-50pc-width",3,"fixedTopGap"],["sidenav",""],["sidenavContent",""],[3,"multiple","selectionChange"],[3,"value",4,"ngFor","ngForOf"],["fixedInViewport","true"],[3,"data","showTitle",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"viewer-margin"],["mat-mini-fab","","color","any","matTooltip",t,3,"click",4,"ngIf"],[3,"value"],["ca","matListOption"],["matListItemTitle",""],["matListItemLine",""],[3,"data","showTitle"],[3,"data","settings"],["poemViewers",""],["mat-mini-fab","","color","any","matTooltip",t,3,"click"],["color","primary","svgIcon","c_clipboard_copy"]]},template:function(o,a){1&o&&(e.TgZ(0,"div",0)(1,"mat-toolbar",1,2),e._UZ(3,"main-buttons")(4,"span",3),e.TgZ(5,"button",4),e.NdJ("click",function(){return a.toggleSidenav()}),e.TgZ(6,"mat-icon"),e._uU(7,"reorder"),e.qZA()()()(),e.TgZ(8,"div")(9,"mat-sidenav-container",5)(10,"mat-sidenav",6,7)(12,"div",null,8)(14,"mat-selection-list",9),e.NdJ("selectionChange",function(s){return a.handleAlbumChange(s)}),e.YNc(15,D,7,6,"mat-list-option",10),e.qZA()()(),e.TgZ(16,"mat-sidenav-content",11),e.YNc(17,G,1,2,"album-meta-viewer",12),e._UZ(18,"p"),e.YNc(19,V,4,2,"div",13),e._UZ(20,"p"),e.TgZ(21,"div",14),e.YNc(22,$,2,0,"button",15),e.qZA(),e._UZ(23,"p"),e.qZA()(),e._UZ(24,"p"),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngClass",a.isSmallScreen?"fx-column-gap-half":"fx-column-gap-1"),e.xp6(9),e.Q6J("fixedTopGap",a.mainToolbarHeight),e.xp6(4),e.Q6J("multiple",!1),e.xp6(1),e.Q6J("ngForOf",a.albums),e.xp6(2),e.Q6J("ngIf",a.currentAlbum.id),e.xp6(2),e.Q6J("ngForOf",a.poemsOfAlbum),e.xp6(3),e.Q6J("ngIf",a.currentAlbum.id&&a.copyAlbumEnabled))},dependencies:[c.mk,c.sg,c.O5,C.nh,Z.Hw,p.Ub,p.vS,p.WW,p.sL,g.JX,g.TM,g.Rh,M.Ye,S.gM,N.X,H.E,O.d,c.uU],encapsulation:2,changeDetection:0}),l})();var k=i(7337),x=i(4683),W=i(1944),K=i(5521),X=i(8645),z=i(2438),q=i(9773),ee=i(1858),te=i(7315),ne=i(5407),oe=i(7358),ae=i(5986),J=i(2557),b=i(3305),I=i(3176),ie=i(4516),R=i(9157),v=i(8445),Y=i(9594);function le(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",25)(1,"button",26),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.tagsAndSearchShouldHide=!1)}),e.TgZ(2,"mat-icon"),e._uU(3,"filter_list"),e.qZA()()()}}function re(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"mat-chip-option",34),e.NdJ("selectionChange",function(a){e.CHM(t);const r=e.oxw(3);return e.KtG(r.handleTagSelectionChange(a))}),e._uU(1),e.qZA()}if(2&n){const t=l.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}function se(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"mat-expansion-panel",27),e.NdJ("opened",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.handleExpansionPanelOpened())})("afterExpand",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.handleExpansionPanelAfterExpand())})("afterCollapse",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.handleExpansionPanelClosed())}),e.TgZ(1,"mat-expansion-panel-header")(2,"mat-panel-title"),e.SDv(3,28),e.qZA(),e.TgZ(4,"mat-panel-description"),e._uU(5),e.qZA()(),e.TgZ(6,"div")(7,"mat-checkbox",29),e._uU(8,"Filtered by multiple tags"),e.qZA()(),e.TgZ(9,"div",30)(10,"mat-chip-listbox",31,32),e.NdJ("change",function(a){e.CHM(t);const r=e.oxw(2);return e.KtG(r.handleTagsChange(a))}),e.YNc(12,re,2,2,"mat-chip-option",33),e.qZA()()()}if(2&n){const t=e.oxw(2);e.xp6(5),e.hij(" ",t.tagNames," "),e.xp6(2),e.Q6J("formControl",t.multipleTagsControl),e.xp6(3),e.Q6J("multiple",t.multipleTagsControl.value),e.xp6(2),e.Q6J("ngForOf",t.tags)}}function ce(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"mat-tree-node",41),e._uU(1," \xa0\xa0\xa0\xa0\xa0\xa0 "),e.TgZ(2,"button",42),e.NdJ("click",function(){const r=e.CHM(t).$implicit,s=e.oxw(4);return e.KtG(s.handleYearMonthNode(r.data))}),e._uU(3),e.qZA()()}if(2&n){const t=l.$implicit;e.xp6(3),e.Oqu(t.data.display)}}function me(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"mat-tree-node",41)(1,"button",43)(2,"mat-icon",44),e._uU(3),e.qZA()(),e.TgZ(4,"button",42),e.NdJ("click",function(){const r=e.CHM(t).$implicit,s=e.oxw(4);return e.KtG(s.handleYearMonthNode(r.data))}),e._uU(5),e.qZA()()}if(2&n){const t=l.$implicit,o=e.oxw(4);e.xp6(1),e.uIk("aria-label","Toggle "+t.name),e.xp6(2),e.hij(" ",o.yearTreeControl.isExpanded(t)?"expand_more":"chevron_right"," "),e.xp6(2),e.Oqu(t.data.display)}}function pe(n,l){if(1&n&&(e.TgZ(0,"mat-tree",38),e.YNc(1,ce,4,1,"mat-tree-node",39),e.YNc(2,me,6,3,"mat-tree-node",40),e.qZA()),2&n){const t=e.oxw(3);e.Q6J("dataSource",t.dataSource)("treeControl",t.yearTreeControl),e.xp6(2),e.Q6J("matTreeNodeDefWhen",t.hasChild)}}function de(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",35,36),e.NdJ("click",function(a){e.CHM(t);const r=e.oxw(2);return e.KtG(r.toggleTree(a))}),e.TgZ(2,"mat-icon"),e._uU(3,"account_tree"),e.qZA()(),e.YNc(4,pe,3,3,"ng-template",37)}if(2&n){const t=e.MAs(1),o=e.oxw(2);e.xp6(4),e.Q6J("cdkConnectedOverlayOrigin",t)("cdkConnectedOverlayOpen",o.isTreeOpen)}}function ue(n,l){if(1&n&&(e.TgZ(0,"span",49),e._uU(1),e.ALo(2,"date"),e.qZA()),2&n){const t=e.oxw().$implicit;let o;e.Q6J("ngClass",t.published?"published":"draft"),e.xp6(1),e.hij("\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0",e.xi3(2,2,null!==(o=t.published)&&void 0!==o?o:t.date,"yyyy-MM-dd"),"")}}function _e(n,l){if(1&n&&(e.TgZ(0,"mat-list-option",45,46)(2,"span",47),e._uU(3),e.qZA(),e.YNc(4,ue,3,5,"span",48),e.qZA()),2&n){const t=l.$implicit,o=e.oxw(2);e.Q6J("value",t.id),e.xp6(3),e.Oqu(t.title),e.xp6(1),e.Q6J("ngIf",o.usePublished)}}function ge(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"mat-sidenav-container",1)(1,"mat-sidenav",2,3)(3,"div",null,4),e.YNc(5,le,4,0,"div",5),e.TgZ(6,"div",6,7),e.YNc(8,se,13,4,"mat-expansion-panel",8),e._UZ(9,"div",9),e.TgZ(10,"mat-grid-list",10)(11,"mat-grid-tile",11),e._uU(12," \xa0\xa0 "),e.TgZ(13,"form",12,13),e.NdJ("ngSubmit",function(){e.CHM(t);const a=e.MAs(14),r=e.oxw();return e.KtG(a.form.valid&&r.search())}),e.TgZ(15,"mat-form-field",14)(16,"mat-label"),e.SDv(17,15),e.qZA(),e._UZ(18,"input",16),e.TgZ(19,"button",17)(20,"mat-icon"),e._uU(21,"search"),e.qZA()(),e.TgZ(22,"button",18),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.clearKeywords())}),e.TgZ(23,"mat-icon"),e._uU(24,"close"),e.qZA()()()()(),e.TgZ(25,"mat-grid-tile",11)(26,"label",19),e._uU(27),e.qZA()(),e.TgZ(28,"mat-grid-tile",11),e.YNc(29,de,5,2,"ng-template",0),e.qZA()()(),e.TgZ(30,"mat-selection-list",20,21),e.NdJ("selectionChange",function(a){e.CHM(t);const r=e.oxw();return e.KtG(r.handlePoemListChange(a))}),e.YNc(32,_e,5,3,"mat-list-option",22),e.qZA()()(),e.TgZ(33,"mat-sidenav-content",23),e._UZ(34,"poem-viewer",24)(35,"p"),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngClass",t.isSmallScreen?"fx-95pc-width":"fx-50pc-width")("fixedTopGap",t.fixedTopGap),e.xp6(4),e.Q6J("ngIf",t.tagsAndSearchShouldHide),e.xp6(1),e.Q6J("hidden",t.tagsAndSearchShouldHide),e.xp6(2),e.Q6J("ngIf",t.tags.length>0),e.xp6(3),e.Q6J("colspan",3),e.xp6(7),e.s9C("placeholder",t.searchBoxPlaceHolder),e.Q6J("formControl",t.keywordsControl),e.xp6(1),e.Q6J("disabled",!t.keywordsControl.value),e.xp6(3),e.Q6J("disabled",!t.keywordsControl.value),e.xp6(3),e.Q6J("colspan",1),e.xp6(2),e.Oqu(t.filteredPoemBriefs.length),e.xp6(1),e.Q6J("colspan",1),e.xp6(1),e.Q6J("ngIf",t.poemBriefs.length>20&&t.chronologyEnabled),e.xp6(1),e.Q6J("multiple",!1),e.xp6(2),e.Q6J("ngForOf",t.filteredPoemBriefs),e.xp6(2),e.Q6J("data",t.currentPoem)("settings",t.poemViewerSettings)}}function fe(n,l){}let he=(()=>{var n;class l extends te.G{constructor(o,a,r,s,u,f,h,F,U,P,Q){super(o,a,r,u,F,U,P,Q),this.poemsService=o,this.alsertService=a,this.dataComponentDialogService=r,this.poemDeletedSubjectService=s,this.alertService=u,this.poemAssociationsChangedSubjectService=f,this.staticContentReloadSubjectService=h,this.langSubjectService=F,this.ref=U,this.scrollDispatcher=P,this.allMetaService=Q,this.staticContentReloadSubscription=this.staticContentReloadSubjectService.getMessage().subscribe(Se=>{this.currentPoem={},this.ref.detectChanges()})}ngOnDestroy(){this.staticContentReloadSubscription.unsubscribe()}}return(n=l).\u0275fac=function(o){return new(o||n)(e.Y36(T.T.Poems),e.Y36(d.c9),e.Y36(d.T4),e.Y36(_.VE),e.Y36(d.c9),e.Y36(_.ks),e.Y36(_.vw),e.Y36(_.IZ),e.Y36(e.sBO),e.Y36(ne.mF),e.Y36(oe.j))},n.\u0275cmp=e.Xpm({type:n,selectors:[["chronicle-for-reader"]],features:[e.qOj],decls:2,vars:2,consts:function(){let t,o;return t=$localize`Search`,o=$localize` Tags `,[[3,"ngIf"],["hasBackdrop","false"],["mode","over","opened","","fixedInViewport","true","position","end","autoFocus","false",3,"ngClass","fixedTopGap"],["sidenav",""],["sidenavContent",""],["class","nav-button-set",4,"ngIf"],[1,"in-sidenav-sticky",3,"hidden"],["tagsAndSearch",""],[3,"opened","afterExpand","afterCollapse",4,"ngIf"],[1,"nav-space-block"],["name","search","cols","5","rowHeight","7em"],[3,"colspan"],["name","searchForm",1,"fx-full-width",3,"ngSubmit"],["f","ngForm"],[1,"fx-95pc-width"],t,["matInput","",3,"formControl","placeholder"],["mat-icon-button","","matPrefix","","type","submit",3,"disabled"],["mat-icon-button","","matSuffix","",3,"disabled","click"],[1,"float-right"],["aria-label","list of poems",3,"multiple","selectionChange"],["poemsSelectionList",""],[3,"value",4,"ngFor","ngForOf"],["fixedInViewport","true"],[3,"data","settings"],[1,"nav-button-set"],["mat-mini-fab","","color","primary","matTooltip","Filters",3,"click"],[3,"opened","afterExpand","afterCollapse"],o,[3,"formControl"],[1,"scroll-tags"],["selectable","",3,"multiple","change"],["tagChipList",""],[3,"value","selectionChange",4,"ngFor","ngForOf"],[3,"value","selectionChange"],["mat-icon-button","","type","button","matTooltip","Chronology","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen"],[1,"scroll-tree",3,"dataSource","treeControl"],["matTreeNodePadding","",4,"matTreeNodeDef"],["matTreeNodePadding","",4,"matTreeNodeDef","matTreeNodeDefWhen"],["matTreeNodePadding",""],["mat-button","",3,"click"],["mat-icon-button","","matTreeNodeToggle",""],[1,"mat-icon-rtl-mirror"],[3,"value"],["ca","matListOption"],["matListItemTitle",""],["matListItemLine","",3,"ngClass",4,"ngIf"],["matListItemLine","",3,"ngClass"]]},template:function(o,a){1&o&&(e.YNc(0,ge,36,18,"ng-template",0),e.YNc(1,fe,0,0,"ng-template",0)),2&o&&(e.Q6J("ngIf",!a.groupedByYearMonth),e.xp6(1),e.Q6J("ngIf",a.groupedByYearMonth))},dependencies:[c.mk,c.sg,c.O5,m._Y,m.Fj,m.JJ,m.JL,m.F,m.oH,C.lW,C.RK,C.nh,ae.oG,J.z2,J.iO,b.ib,b.yz,b.yK,b.u4,I.Il,I.DX,Z.Hw,ie.Nt,R.KE,R.hX,R.qo,R.R9,p.Ub,p.vS,p.WW,p.sL,g.JX,g.TM,g.Rh,S.gM,v.fQ,v.ah,v.eu,v.gi,v.uo,Y.pI,Y.xu,N.X,c.uU],encapsulation:2,changeDetection:0}),l})();function Ce(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"button",8),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.reload())}),e.TgZ(1,"mat-icon"),e._uU(2,"refresh"),e.qZA()()}}let w=(()=>{var n;class l extends K.A{get updateAvailable(){return W.d.swUpdateAvailable}constructor(o,a,r,s,u,f,h){super(o,r,s),this.alertService=o,this.poemsService=a,this.basicDataLoaderService=r,this.waitService=s,this.viewSettingsDialogService=u,this.staticContentReloadSubjectService=f,this.ref=h,this.unsubscriber=new X.x,console.debug("MainForReaderComponent created. IsSmallScreen: "+this.isSmallScreen),this.staticContentReloadSubscription=this.staticContentReloadSubjectService.getMessage().subscribe(F=>{this.reload()})}ngOnInit(){console.debug("MainForReaderComponent init."),history.pushState(null,""),(0,z.R)(window,"popstate").pipe((0,q.R)(this.unsubscriber)).subscribe(o=>{history.pushState(null,""),console.debug("Not allow to go back to login")})}ngOnDestroy(){this.staticContentReloadSubscription.unsubscribe(),this.unsubscriber.next(),this.unsubscriber.complete()}loadBriefs(){k.y.staticReadonly?this.basicDataLoaderService.allMetaService.getBriefsOfPoems().subscribe(o=>{x.f.usePublished||o.sort((a,r)=>a.title.localeCompare(r.title,x.f.defaultWrittenLanguage)),this.poemBriefs=o,this.chronicle?(this.chronicle.filteredPoemBriefs=o.slice(),console.debug("this.chronicle.filteredPoemBriefs assigned.")):console.debug("chronicle not yet available."),this.ref.detectChanges(),this.waitService.setWait({loading:!1})}):this.poemsService.getBriefsOfPoems(x.f.convertZhHandler).subscribe({next:o=>{o&&(x.f.usePublished||o.sort((a,r)=>a.title.localeCompare(r.title,x.f.defaultWrittenLanguage)),this.poemBriefs=o,this.chronicle&&(this.chronicle.filteredPoemBriefs=o.slice()),this.ref.detectChanges()),this.waitService.setWait({loading:!1})},error:o=>{this.waitService.setWait({loading:!1}),this.alertService.error(o)}})}showViewSettings(){this.viewSettingsDialogService.open()}}return(n=l).\u0275fac=function(o){return new(o||n)(e.Y36(d.c9),e.Y36(T.T.Poems),e.Y36(E.k),e.Y36(d.ii),e.Y36(ee.M),e.Y36(_.vw),e.Y36(e.sBO))},n.\u0275cmp=e.Xpm({type:n,selectors:[["main-for-reader"]],features:[e.qOj],decls:14,vars:3,consts:[[1,"fixed-top","semi-transparent","toolbar-custom",3,"ngClass"],["toolbar",""],["mat-mini-fab","","color","any","type","button","aria-label","refresh","matTooltip","Reload data",3,"click",4,"ngIf"],[1,"toolbar-spacer"],["type","button","mat-mini-fab","","color","any","aria-label","settings",3,"click"],["mat-mini-fab","","color","any","type","button","aria-label","toggle sidebar",3,"click"],[3,"poemBriefs"],["chronicle",""],["mat-mini-fab","","color","any","type","button","aria-label","refresh","matTooltip","Reload data",3,"click"]],template:function(o,a){1&o&&(e.TgZ(0,"mat-toolbar",0,1),e._UZ(2,"main-buttons"),e.YNc(3,Ce,3,0,"button",2),e._UZ(4,"span",3),e.TgZ(5,"button",4),e.NdJ("click",function(){return a.showViewSettings()}),e.TgZ(6,"mat-icon"),e._uU(7,"settings"),e.qZA()(),e.TgZ(8,"button",5),e.NdJ("click",function(){return a.toggleSidenav()}),e.TgZ(9,"mat-icon"),e._uU(10,"reorder"),e.qZA()()(),e.TgZ(11,"div"),e._UZ(12,"chronicle-for-reader",6,7),e.qZA()),2&o&&(e.Q6J("ngClass",a.isSmallScreen?"fx-column-gap-half":"fx-column-gap-1"),e.xp6(3),e.Q6J("ngIf",!a.isStaticReadonly&&!a.updateAvailable),e.xp6(9),e.Q6J("poemBriefs",a.poemBriefs))},dependencies:[c.mk,c.O5,C.nh,Z.Hw,M.Ye,S.gM,O.d,he],encapsulation:2}),l})();var xe=i(984);const ve=[{path:"",component:(()=>{var n;class l extends xe.w{constructor(){super()}}return(n=l).\u0275fac=function(o){return new(o||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["reader-index"]],features:[e.qOj],decls:2,vars:0,consts:[[1,"content-top-padding-relative"]],template:function(o,a){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"router-outlet"),e.qZA())},dependencies:[A.lC],encapsulation:2}),l})(),children:[{path:"",component:w},{path:"chronicle",component:w},{path:"albums",component:j}]}];let Te=(()=>{var n;class l{}return(n=l).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[A.Bz.forChild(ve),A.Bz]}),l})();var be=i(6208);let Re=(()=>{var n;class l{}return(n=l).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[c.ez,m.u5,m.UX,L.V,be.m,Te]}),l})()}}]);